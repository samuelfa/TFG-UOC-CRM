---
- name: Add PHP 7 PPA repository
  become: true
  apt_repository:
    repo: 'ppa:ondrej/php'

- name: Install PHP packages
  become: true
  apt:
    name:
      - php7.4-cli
      - php7.4-fpm
      - php7.4-redis
      - php7.4-pdo
      - php7.4-pdo_mysql
      - php7.4-mbstring
      - php7.4-zip
    state: latest

- name: Set date.timezone for CLI
  become: true
  lineinfile:
    dest: /etc/php/7.4/cli/php.ini
    regexp: "date.timezone ="
    line: "date.timezone = Europe/Madrid"

- name: Set date.timezone for FPM
  become: true
  lineinfile:
    dest: /etc/php/7.4/fpm/php.ini
    regexp: "date.timezone ="
    line: "date.timezone = Europe/Madrid"